Эта диаграмма последовательности показывает весь процесс взаимодействия пользователя с приложением - от выбора книги до отображения данных. Рассмотрим ключевые этапы:
1. Инициализация

BooksView запускает useBookContextProvider(), который создает центральный контекст
Контекст инициализирует все необходимые хранилища данных (stores)
После загрузки данных контекст предоставляется компонентам

2. Выбор книги

Пользователь кликает по книге в компоненте BookSelector
toggleBook() вызывает selectBook() в контексте
Контекст обновляет массив выбранных книг и запускает refreshData()
Происходит обновление данных через хранилища и применение фильтров
Вычисляемое свойство currentBook обновляется

3. Отображение панели книги

BooksView отображает DashBoardBook (условный рендеринг через v-if)
DashBoardBook отображает BookFinanceSummary и BookTransactionsList

4. Получение финансовых данных

BookFinanceSummary использует useBookFinanceSummary(), который получает данные из контекста
Контекст предоставляет доступ к фильтрам и методу получения финансовых данных
Выполняется расчет и форматирование сумм доходов и расходов

5. Распределение расходов по владельцам

Через usePercentageSlider() получаются данные о правилах распределения
Отображается слайдер с процентами владения для каждого участника

6. Получение транзакций

BookTransactionsList использует useBookTransactions() для получения транзакций
Контекст применяет фильтры по книге и датам и возвращает отфильтрованные транзакции
Транзакции группируются по дате для удобного отображения

7. Изменение фильтра дат

Пользователь меняет период или дату в фильтре
onDateFilterChange() проверяет, действительно ли изменились данные
При реальном изменении вызывается updateDateFilter(), который обновляет контекст
Контекст запускает обновление данных и применяет новые фильтры
Обновленные данные отображаются в компонентах

Эта архитектура обеспечивает четкое разделение ответственности между компонентами, централизованное управление состоянием через контекст и эффективное обновление данных при взаимодействии пользователя с приложением.


## BooksView.vue
src/views/book/page/BooksView.vue - страница, состоит из двух компонентов: 

    src/views/book/page/components/BookSelector.vue - выбор книги
    src/views/book/page/components/DashBoardBook.vue - информация на странице

## BookSelector.vue 
Выбор книги или книг и создание новой

## DashBoardBook.vue 
Это информация по выбранной книги (книгам)

src/views/book/page/components/BookFinanceSummary.vue
src/views/book/page/components/BookTransactionsList.vue

## BookFinanceSummary.vue
Это инфомрация по книги и фильтр

Информация по выбранной книги и фильтру - useBookData.ts
Понять какая книга выбрана, и какие фильтры по дате выбраны. 

По сути мне надо получить данные 
Total, income, expense - за это отвечает [создать отдельный composable]
Данные для слайдера - за это отвечает useOwnerDistribution.ts

за стили отвечает - useFormatting.ts



Задача следующая, 

каждая транзакция имеет bookAmount: -35000 мы должны использовать это поле. Также мы должны правильно высчитывать процент распределия, кто сколько потратил.  distributionRules: [
      { ownerId: "user_1", percentage: 30 },
      { ownerId: "user_2", percentage: 70 }

То есть когда мы в слайдере должны посчитать, кто и что потратил мы должны bookAmount * percentage: 30 и прибавить к расходам юзера и так для каждой транзакции. 

В Transaction list мы должны отображать bookAmount

А в src/views/book/page/components/BookFinanceSummary.vue считать income and expense, тоже по полю bookAmount

Для ситуаций когда выбраны больше одной книги и их валюты различаются, мы должны для отображения использовать валюту пользователя, из user.store  settings.baseCurrency: 'RUB',  и тогда использовать курс export const defaultExchangeRates: ExchangeRate[] = [


Давай изменим функции и добавим логирование. 


### src/components/ui/filters/DateFilter.vue

### src/views/book/page/components/BookPercentageSlider.vue

### composables src/views/book/page/composables/useOwnerDistribution.ts

Нужен для расчета показаний для BookFinanceSummary

src/views/book/page/composables/useBookData.ts
src/views/book/page/composables/useBookFinanceSummary.ts
src/views/book/page/composables/useFormatting.ts


Логика работы компонента

Выбор книги: 
1. Выбираем книгу или книги. 
2. Проверяем е в книге правила распределения или нет. Если их нет не показываем слайдер. Если есть показываем. Если мы выбрали больше одной книги и в хоть в одной есть распределение, до мы показываем слайдер.
3. Дальше мы применяем фильтр по датам.

Общий расчет сумм:
Считаем суммы Total, income, expense

Слайдер:
1. Если есть слайдер мы находим форматы для пользователей из User Store их имена и цвет, отображаем. 
2. Расчитываем кто, сколько потратил. Если выбрано много книг, те что без распределения, траты суммируются к владельцу этой книги. 
5. Дальше мы расчитываем проценты за заданный период и по заданным книгам.

