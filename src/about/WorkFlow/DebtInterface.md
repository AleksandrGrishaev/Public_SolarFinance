# Финансовая система: проектирование и план реализации

## Содержание
- [Обзор системы](#обзор-системы)
- [Структура данных](#структура-данных)
  - [Пользователи и контакты](#пользователи-и-контакты)
  - [Книги](#книги)
  - [Счета](#счета)
  - [Долги и кредиты](#долги-и-кредиты)
  - [Транзакции](#транзакции)
- [Интерфейсы](#интерфейсы)
  - [Управление книгами и распределением](#управление-книгами-и-распределением)
  - [Переводы между пользователями](#переводы-между-пользователями)
  - [Долги и кредиты](#интерфейс-долгов-и-кредитов)
  - [Групповые события](#групповые-события)
- [План реализации](#план-реализации)
  - [Этап 1: Модификация книг и внутренних расчетов](#этап-1-модификация-книг-и-внутренних-расчетов)
  - [Этап 2: Внешние долги и пользователи](#этап-2-внешние-долги-и-пользователи)
  - [Этап 3: Групповые книги и события](#этап-3-групповые-книги-и-события)
  - [Этап 4: Улучшение интерфейса и аналитика](#этап-4-улучшение-интерфейса-и-аналитика)

## Обзор системы

Финансовая система предназначена для управления личными, семейными и групповыми финансами с возможностью учета различных долговых отношений, расчетов между участниками и распределения финансовой ответственности.

**Основные возможности:**
- Учет личных и общих финансов
- Распределение расходов между членами семьи/группы
- Управление долгами и кредитами
- Отслеживание переводов между участниками
- Автоматический расчет баланса и взаиморасчетов

## Структура данных

### Пользователи и контакты

```typescript
// Базовый тип для пользователей и контактов
export interface Person {
  id: string;
  name: string;
  type: PersonType;
  avatar?: string;
  createdAt: Date;
  updatedAt: Date;
}

// Типы личностей в системе
export type PersonType = 'user' | 'owner' | 'family_member' | 'external_contact' | 'group_member';

// Зарегистрированный пользователь системы
export interface User extends Person {
  type: Extract<PersonType, 'user'>;
  username: string;
  pin: string;
  email?: string;
  isActive: boolean;
  lastLoginAt?: Date;
  settings: UserSettings;
}

// Внешний контакт (не зарегистрированный в системе)
export interface ExternalContact extends Person {
  type: Extract<PersonType, 'external_contact' | 'group_member'>;
  phone?: string;
  email?: string;
  notes?: string;
  createdBy: string;        // ID пользователя, создавшего контакт
}

// Настройки пользователя
export interface UserSettings {
  theme: 'light' | 'dark' | 'system';
  language: string;
  defaultBookId?: string;
  baseCurrency: string; 
  color?: string;
}
```

### Книги

```typescript
// Книга - основной контейнер для учета финансов
export interface Book {
  id: string;
  name: string;
  description?: string;
  ownerIds: string[];       // ID владельцев книги
  distributionRules?: DistributionRule[];  // Правила распределения расходов
  icon?: string;
  color: string;
  currency: string;         // Базовая валюта книги
  status: 'active' | 'completed';  // Статус книги
  createdAt: Date;
  updatedAt: Date;
}

// Правило распределения расходов в книге
export interface DistributionRule {
  ownerId: string;
  percentage: number;       // Процент участия (0-100)
}
```

### Счета

```typescript
// Счет - источник или хранилище средств
export interface Account {
  id: string;
  name: string;
  ownerId: string;          // ID владельца счета
  bookIds: string[];        // ID книг, в которых используется счет
  currency: string;
  initialBalance: number;
  currentBalance: number;
  color: string;
  symbol: string;
  icon?: string;
  type: AccountType;
  isActive: boolean;
  createdAt: Date;
  updatedAt: Date;
  sharing?: AccountSharing;  // Права доступа для других пользователей
}

// Типы счетов
export type AccountType = 'cash' | 'bank' | 'card' | 'credit_card' | 'savings' | 'investment';

// Уровни доступа к счету
export type SharingPermission = 'no' | 'view' | 'edit';

// Права доступа по ID пользователя
export type AccountSharing = Record<string, SharingPermission>;
```

### Долги и кредиты

```typescript
// Долг - обязательство между участниками
export interface Debt {
  id: string;
  name: string;             // Название долга/кредита
  amount: number;           // Первоначальная сумма
  remainingAmount: number;  // Оставшаяся сумма
  currency: string;
  type: DebtType;           // Тип долга
  category: DebtCategory;   // Категория долга
  status: DebtStatus;       // Статус долга
  source: DebtSource;       // Источник возникновения
  
  createdAt: Date;
  updatedAt: Date;
  startDate: Date;          // Дата начала
  endDate?: Date;           // Дата планового окончания
  dueDate?: Date;           // Срок следующего платежа
  description?: string;
  bookId?: string;          // ID книги (для семейных долгов)
  
  // Для внешних долгов
  creditorType: 'bank' | 'organization' | 'person';
  creditorId?: string;      // ID человека, если creditorType === 'person'
  creditorName: string;     // Название банка или имя человека
  interestRate?: number;    // Процентная ставка
  totalInterest?: number;   // Общая сумма процентов за весь срок
  
  // Участники долга
  fromParties?: DebtParty[];// Кто должен (может быть несколько)
  toParties?: DebtParty[];  // Кому должен (может быть несколько)
  
  // Связь со счетом зачисления
  linkedAccountId?: string;
  
  // График и история платежей
  paymentSchedule?: PaymentSchedule;
  paymentHistory?: DebtPayment[];
}

// Типы долгов
export type DebtType = 'internal' | 'external' | 'family' | 'group';

// Категории долгов
export type DebtCategory = 'loan' | 'mortgage' | 'credit_card' | 'personal_loan' | 'family_debt' | 'group_debt';

// Статусы долгов
export type DebtStatus = 'active' | 'partially_paid' | 'paid' | 'cancelled';

// Источники долгов
export type DebtSource = 'transaction' | 'manual' | 'credit' | 'mortgage';

// Участник долгового отношения
export interface DebtParty {
  entityId: string;         // ID пользователя или группы
  entityType: 'user' | 'group'; // Тип участника
  percentage: number;       // Процент ответственности (0-100)
}

// График платежей
export interface PaymentSchedule {
  type: 'monthly' | 'quarterly' | 'annual' | 'custom';
  dayOfMonth?: number;      // День месяца для регулярного платежа
  amount: number;           // Сумма регулярного платежа
  totalPayments: number;    // Общее количество платежей
  remainingPayments: number;// Оставшиеся платежи
  nextPaymentDate: Date;    // Дата следующего платежа
}

// Запись о платеже по долгу
export interface DebtPayment {
  id: string;
  debtId: string;
  amount: number;
  currency: string;
  date: Date;
  paymentType: 'regular' | 'early' | 'partial';
  description?: string;
  transactionId?: string;   // ID связанной транзакции
  payerId: string;          // Кто фактически совершил платеж
  accountId: string;        // С какого счета произведен платеж
}
```

### Транзакции

```typescript
// Транзакция - финансовая операция
export interface Transaction {
  id: string;
  date: Date;
  amount: number;
  type: TransactionType;     // Основной тип
  subType?: TransactionSubType; // Подтип для детализации
  
  // Источник и получатель средств
  sourceEntityId: string;    // ID источника
  targetEntityId?: string;   // ID получателя
  sourceEntityType: 'account' | 'debt' | 'person' | 'external';
  targetEntityType: 'account' | 'debt' | 'person' | 'external';
  
  // Для переводов между пользователями
  targetUserId?: string;     // ID пользователя-получателя
  targetAccountId?: string;  // ID счета-получателя
  transferStatus?: 'pending' | 'completed' | 'cancelled';
  
  bookId?: string;           // ID книги
  categoryId?: string;       // ID категории
  
  distributionRules?: DistributionRule[]; // Правила распределения
  relatedDebtId?: string;    // ID связанного долга/кредита
  
  description?: string;
  tags?: string[];
  
  // Дополнительные флаги
  isSettlement?: boolean;    // Это расчет по балансу?
  
  // Для платежей от имени других людей
  onBehalfOfId?: string;     // ID человека, от имени которого совершается платеж
  registeredBy: string;      // ID пользователя, зарегистрировавшего транзакцию
}

// Основные типы транзакций
export type TransactionType = 
  | 'income'      // доход
  | 'expense'     // расход
  | 'transfer'    // перевод средств
  | 'debt'        // долговые отношения
  | 'correction'  // коррекция баланса
  | 'exchange';   // обмен валюты

// Подтипы транзакций
export type TransactionSubType = 
  // Для переводов
  | 'transfer_internal'      // между своими счетами
  | 'transfer_external'      // между разными пользователями
  | 'transfer_settlement'    // расчет по балансу книги
  
  // Для долговых операций
  | 'debt_creation'          // создание долга
  | 'debt_payment'           // оплата долга
  | 'debt_credit_disburse'   // выдача кредита (получение)
  | 'debt_credit_payment'    // платеж по кредиту
  | 'debt_forgiveness';      // прощение долга
```

## Интерфейсы

### Управление книгами и распределением

#### Создание и настройка групповой книги

```
+--------------------------------------------------------------------------------------+
| Создание новой книги                                                                 |
+--------------------------------------------------------------------------------------+
| Тип книги:  ◉ Личная   ◯ Семейная   ◯ Бизнес   ◯ Проект   ◉ Группа                |
+--------------------------------------------------------------------------------------+
| Название: Подарок Ивану на день рождения                                             |
| Описание: Сбор средств на подарок                                                    |
| Валюта: [RUB ▼]                                                                      |
|                                                                                      |
| Участники:                                                                           |
| + Вы (Alex)                                                                          |
| + Жена (Sasha Solar)                                                                 |
| + [+ Добавить участника]                                                             |
|                                                                                      |
| [+ Добавить внешнего участника]                                                      |
| - Имя: Мария                                                                         |
| - Контакт: +7 (900) 123-45-67                                                        |
| [Сохранить участника]                                                                |
|                                                                                      |
| Распределение:                                                                       |
| [ ] Равное распределение                                                             |
| [✓] Индивидуальное распределение:                                                    |
| - Alex: 40%                                                                          |
| - Sasha Solar: 40%                                                                   |
| - Мария: 20%                                                                         |
|                                                                                      |
| [Создать книгу]                                                                      |
+--------------------------------------------------------------------------------------+
```

#### Просмотр баланса групповой книги

```
+--------------------------------------------------------------------------------------+
| Подарок Ивану на день рождения                                                       |
+--------------------------------------------------------------------------------------+
| ОБЩАЯ ИНФОРМАЦИЯ                | УЧАСТНИКИ                   | РАСХОДЫ                |
+--------------------------------------------------------------------------------------+
| Цель: Подарок                   | Alex (вы): 40% - 4,000₽     | Общая сумма: 7,500₽   |
| Цель: Подарок                   | Sasha Solar: 40% - 4,000₽   | Запланировано: 10,000₽|
| Создана: 15.04.2025             | Мария: 20% - 2,000₽         |                       |
| Завершение: 20.05.2025          |                             | [+ Добавить расход]    |
| Статус: Активна                 |                             |                       |
|                                 | ВНЕСЕНО:                    | СПИСОК РАСХОДОВ:       |
| ФИНАНСОВЫЙ БАЛАНС               | Alex (вы): 3,000₽ из 4,000₽ | Заказ подарка - 7,500₽|
| Собрано: 5,000₽ из 10,000₽      | Sasha Solar: 2,000₽ из 4,000₽| Оплатил: Alex        |
| Потрачено: 7,500₽               | Мария: 0₽ из 2,000₽         | Дата: 18.04.2025      |
| Баланс: -2,500₽                 |                             |                       |
|                                 | [Внести платеж от участника] |                       |
+--------------------------------------------------------------------------------------+
| КТО КОМУ ДОЛЖЕН                                                                      |
+--------------------------------------------------------------------------------------+
| Alex внес больше на 3,500₽                                                           |
| Sasha Solar должна → Alex: 2,000₽                                                    |
| Мария должна → Alex: 1,500₽                                                          |
|                                                                                      |
| [Отметить как погашенный]                                                            |
+--------------------------------------------------------------------------------------+
```

### Переводы между пользователями

#### Создание перевода

```
+--------------------------------------------------------------------------------------+
| Новый перевод                                                                        |
+--------------------------------------------------------------------------------------+
| От кого: [Вы (Alex)]                                                                 |
| Счет списания: [Карта Сбербанк ▼]                                                    |
|                                                                                      |
| Кому: [Sasha Solar ▼]                                                                |
| Сумма: [5,000] ₽                                                                     |
|                                                                                      |
| Выберите тип перевода:                                                               |
| ◯ Обычный перевод                                                                    |
| ◉ Расчет по общему балансу                                                           |
|                                                                                      |
| Примечание: Погашение долга за апрель                                                |
|                                                                                      |
| [Создать перевод]                                                                    |
+--------------------------------------------------------------------------------------+
```

#### Подтверждение получения

```
+--------------------------------------------------------------------------------------+
| Входящие переводы                                                                    |
+--------------------------------------------------------------------------------------+
| От: Alex                                                                             |
| Сумма: 5,000₽                                                                        |
| Примечание: Погашение долга за апрель                                                |
| Тип: Расчет по общему балансу                                                        |
| Дата создания: 26.04.2025                                                            |
|                                                                                      |
| Выберите счет для зачисления:                                                        |
| ◯ Банковский счет супруги                                                            |
| ◉ Зарплатная карта супруги                                                           |
| ◯ Кредитная карта                                                                    |
|                                                                                      |
| [Подтвердить получение]  [Отклонить]                                                 |
+--------------------------------------------------------------------------------------+
```

### Интерфейс долгов и кредитов

#### Список долгов и кредитов

```
+--------------------------------------------------------------------------------------+
| Долги и кредиты                                                     + Создать новый  |
+--------------------------------------------------------------------------------------+
| Фильтры:  [Все типы ▼]  [Все участники ▼]  [Все книги ▼]  [Статус ▼]  [Поиск...   ] |
+--------------------------------------------------------------------------------------+
| АКТИВНЫЕ КРЕДИТЫ И ДОЛГИ                                                             |
+--------------------------------------------------------------------------------------+
| Ипотека Сбербанк                                                                     |
| 2,500,000₽ (из 3,000,000₽)  |  Ежемесячный платеж: 18,500₽  |  След. платеж: 25 мая |
| Участники: Вы (50%), Жена (50%)  |  Банк: Сбербанк  |  Срок: 15 лет  |  10.5%       |
+--------------------------------------------------------------------------------------+
| Долг Жене                                                                            |
| 12,500₽  |  Внутренний долг  |  Создан 12.04.2025                                    |
| Должник: Вы (100%)  |  Кредитор: Жена  |  Причина: обеденные расходы                 |
| [Погасить]                                                                           |
+--------------------------------------------------------------------------------------+
| Семейный баланс за Апрель                                                            |
| Вы должны Жене: 3,750₽                                                               |
| Базируется на записях из "Семейной книги" за Апрель 2025                             |
| [Погасить]                                                                           |
+--------------------------------------------------------------------------------------+
| ЗАВЕРШЕННЫЕ                                                                          |
+--------------------------------------------------------------------------------------+
| Кредит на телефон (Погашен)                                                          |
| 0₽ (из 75,000₽)  |  Погашен досрочно  |  Окончен 10.03.2025                         |
| Участники: Вы (100%)  |  Банк: МТС-Банк  |  Срок: 12 мес  |  19.9%                  |
+--------------------------------------------------------------------------------------+
```

#### Создание кредита/займа

```
+--------------------------------------------------------------------------------------+
| Создание кредита/займа                                                               |
+--------------------------------------------------------------------------------------+
| Тип:                                                                                 |
| ◉ Кредит (вы должны)                                                                 |
| ◯ Займ (вам должны)                                                                  |
|                                                                                      |
| Кредитор:                                                                            |
| ◯ Банк/Организация: [Сбербанк ▼]                                                     |
| ◉ Физическое лицо:                                                                   |
|    ◯ [Выбрать из контактов ▼]                                                        |
|    ◉ Новый контакт:                                                                  |
|       Имя: Петр Иванович                                                             |
|       Телефон: +7 (900) 111-22-33                                                    |
|       Email: petr@example.com                                                        |
|                                                                                      |
| Параметры кредита:                                                                   |
| Название: Займ на покупку техники                                                    |
| Сумма: [50,000] ₽                                                                    |
| Процентная ставка: [0] % годовых                                                     |
| Дата получения: [15.04.2025]                                                         |
| Срок возврата: [15.07.2025]                                                          |
|                                                                                      |
| Ответственность:                                                                     |
| ◉ Личная (100% вы)                                                                   |
| ◯ Семейная:                                                                          |
|    - Вы: [50] %                                                                      |
|    - Sasha Solar: [50] %                                                             |
|                                                                                      |
| Книга:                                                                               |
| [My ▼]                                                                               |
|                                                                                      |
| Зачисление средств:                                                                  |
| Счет: [Наличные ▼]                                                                   |
|                                                                                      |
| [Создать и зачислить]                                                                |
+--------------------------------------------------------------------------------------+
```

#### Детальный просмотр кредита

```
+--------------------------------------------------------------------------------------+
| Ипотека Сбербанк                                               [Редактировать]       |
+--------------------------------------------------------------------------------------+
| ОСНОВНАЯ ИНФОРМАЦИЯ             | ГРАФИК ПЛАТЕЖЕЙ              | ИСТОРИЯ ПЛАТЕЖЕЙ    |
+--------------------------------------------------------------------------------------+
| Сумма: 3,000,000₽               | График: Ежемесячно, 25 число | 25.04.25 - 18,500₽ |
| Остаток: 2,500,000₽             | Платеж: 18,500₽              | 25.03.25 - 18,500₽ |
| Ставка: 10.5% годовых           | Осталось: 165 платежей       | 25.02.25 - 18,500₽ |
| Срок: 15 лет (180 платежей)     | Общая переплата: 1,340,000₽  | 25.01.25 - 18,500₽ |
| Начало: 25.12.2024              | След. платеж: 25.05.2025     |                    |
| Окончание: 25.12.2039           |                              | [Показать все]     |
| Кредитор: Сбербанк              | [Создать платеж]             |                    |
|                                 |                              |                    |
| ОТВЕТСТВЕННОСТЬ                 | СВЯЗАННЫЕ СЧЕТА              |                    |
| Вы: 50% (1,500,000₽)            | Зачисление: Карта Сбербанк   |                    |
| Жена: 50% (1,500,000₽)          | Выплаты: Карта Сбербанк      |                    |
|                                 |                              |                    |
+--------------------------------------------------------------------------------------+
```

### Групповые события

#### Создание нового группового события (через книгу)

```
+--------------------------------------------------------------------------------------+
| Создать событие                                                                      |
+--------------------------------------------------------------------------------------+
| Название: Поездка в Сочи                                                             |
| Описание: Летний отпуск 2025                                                         |
|                                                                                      |
| Планируемый бюджет: [120,000] ₽                                                      |
|                                                                                      |
| Участники:                                                                           |
| + Вы (Alex)                                                                          |
| + Жена (Sasha Solar)                                                                 |
| + [Добавить участника]                                                               |
|                                                                                      |
| Распределение расходов:                                                              |
| [✓] Равное распределение (50% / 50%)                                                 |
| [ ] Индивидуальное распределение                                                     |
|                                                                                      |
| [Создать книгу]                                                                      |
+--------------------------------------------------------------------------------------+
```

#### Добавление расхода в групповое событие

```
+--------------------------------------------------------------------------------------+
| Добавить расход в "Поездка в Сочи"                                                   |
+--------------------------------------------------------------------------------------+
| Описание: Билеты на самолет                                                          |
| Сумма: [45,000] ₽                                                                    |
| Дата: [26.04.2025]                                                                   |
|                                                                                      |
| Кто оплатил:                                                                         |
| ◉ Вы (Alex)                                                                          |
| ◯ Sasha Solar                                                                        |
|                                                                                      |
| Счет списания: [Карта Сбербанк ▼]                                                    |
|                                                                                      |
| Распределение этого расхода:                                                         |
| [✓] Использовать стандартное распределение группы (50% / 50%)                        |
| [ ] Указать индивидуальное для этого расхода                                         |
|                                                                                      |
| [Добавить расход]                                                                    |
+--------------------------------------------------------------------------------------+
```

## План реализации

### Этап 1: Модификация книг и внутренних расчетов

**Задачи:**
1. Обновить структуру книг для поддержки более гибкого распределения
2. Реализовать автоматический расчет баланса в книгах с распределением
3. Разработать интерфейс расчетов по семейному балансу
4. Добавить систему уведомлений о необходимости взаиморасчетов

**Ожидаемый результат:**
- Пользователи могут видеть текущий баланс распределения в книге
- Система предлагает удобные способы выравнивания баланса
- Упрощенный процесс учета долей в общих расходах

### Этап 2: Внешние долги и пользователи

**Задачи:**
1. Реализовать расширенную структуру долгов с поддержкой разных типов
2. Создать интерфейс управления долгами и кредитами
3. Добавить поддержку внешних контактов
4. Разработать систему учета платежей по долгам и кредитам

**Ожидаемый результат:**
- Пользователи могут создавать и отслеживать различные типы долгов
- Система учитывает платежи по кредитам и напоминает о предстоящих платежах
- Добавлена возможность работы с внешними контактами

### Этап 3: Улучшенная работа с книгами для разных целей

**Задачи:**
1. Оптимизировать интерфейс для работы с книгами под разные цели
2. Реализовать систему группировки расходов в рамках книг
3. Интегрировать систему расчетов для многопользовательских книг
4. Обеспечить возможность учета участия внешних пользователей

**Ожидаемый результат:**
- Поддержка разных сценариев использования книг (семья, подарки, путешествия)
- Автоматическое распределение расходов между участниками
- Учет вкладов каждого участника и формирование баланса

### Этап 4: Улучшение интерфейса и аналитика

**Задачи:**
1. Создать удобные дашборды для отображения финансового состояния
2. Добавить аналитику для долгов и кредитов
3. Улучшить навигацию и пользовательский интерфейс
4. Разработать систему шаблонов для частых операций

**Ожидаемый результат:**
- Детальная аналитика финансового состояния пользователя/семьи
- Удобные визуализации долговых обязательств и графиков платежей
- Интуитивно понятный интерфейс для всех типов операций
- Ускорение рутинных финансовых операций через шаблоны

## Приоритизация и детализация плана

### Краткосрочные задачи (1-2 месяца)

1. **Модификация книг с распределением (2 недели)**
   - Обновить структуру `Book` для поддержки расширенных правил распределения
   - Добавить логику расчета баланса для книг с распределением
   - Реализовать UI для отображения текущего баланса книги

2. **Система внутренних расчетов (2 недели)**
   - Добавить тип транзакции с подтипом `transfer_settlement`
   - Реализовать интерфейс погашения внутрисемейного баланса
   - Создать систему уведомлений о необходимости взаиморасчетов

3. **Базовый интерфейс долгов (2 недели)**
   - Обновить структуру `Debt` согласно новой спецификации
   - Создать базовый интерфейс для просмотра и управления долгами
   - Реализовать создание и погашение внутренних долгов

### Среднесрочные задачи (3-4 месяца)

4. **Расширенная поддержка внешних долгов и кредитов (3 недели)**
   - Добавить функциональность создания и ведения кредитов
   - Реализовать график платежей и историю выплат
   - Создать систему напоминаний о предстоящих платежах

5. **Внешние контакты и пользователи (2 недели)**
   - Создать структуру `ExternalContact`
   - Реализовать интерфейс управления внешними контактами
   - Интегрировать контакты в систему долгов и переводов

6. **Переводы между пользователями (3 недели)**
   - Реализовать механизм переводов с подтверждением получателем
   - Создать интерфейс входящих и исходящих переводов
   - Интегрировать с системой долгов для автоматического погашения

### Долгосрочные задачи (5-6 месяцев)

7. **Оптимизация книг для разных целей (4 недели)**
   - Обеспечить удобное управление книгами для разных целей и групп
   - Создать интерфейс группировки расходов
   - Реализовать учет балансов и взаиморасчетов

8. **Аналитика и отчетность (3 недели)**
   - Создать дашборды для отображения долговых обязательств
   - Реализовать график выплат по всем кредитам/долгам
   - Добавить прогнозирование будущих финансовых обязательств

9. **Улучшения UX/UI (3 недели)**
   - Оптимизировать интерфейс для повседневных операций
   - Создать систему шаблонов для частых транзакций
   - Улучшить визуализацию финансовых данных

## Технические рекомендации

1. **Архитектурный подход:**
   - Сохранить существующую структуру хранилищ (stores)
   - Добавить отдельное хранилище для долгов/кредитов
   - Использовать композаблы для общей логики между компонентами

2. **Управление состоянием:**
   - Использовать Pinia/Vuex для глобального состояния
   - Создать действия (actions) для основных операций с долгами/кредитами
   - Реализовать геттеры для удобного доступа к расчетным данным

3. **Организация компонентов:**
   - Создать переиспользуемые компоненты для долговых карточек, слайдеров распределения
   - Разделить логику и представление через композаблы
   - Использовать компоненты-контейнеры для сложных страниц

4. **Производительность:**
   - Реализовать отложенную загрузку редко используемых компонентов
   - Кэшировать результаты сложных вычислений (например, баланс книги)
   - Оптимизировать запросы к хранилищу для больших объемов данных

## Заключение

Предложенная модификация финансовой системы обеспечивает комплексное решение для управления различными типами долговых отношений, от простых внутрисемейных расчетов до сложных кредитов и групповых событий. 

План реализации разделен на логические этапы, что позволяет постепенно вводить новую функциональность, не нарушая работу существующей системы. Приоритет отдан модификации книг и внутренним расчетам, так как эта функциональность является базовой для дальнейшего развития системы.

Такой подход обеспечит пользователям удобный и интуитивно понятный способ управления всеми финансовыми аспектами - от личных счетов до семейных расходов и групповых мероприятий, с четким пониманием всех финансовых обязательств и возможностью эффективного распределения ответственности.